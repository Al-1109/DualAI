## Уточненная архитектура взаимодействия с пользователями

### Унификация брендинга

Для обеспечения единого брендинга и узнаваемости сервиса название бота изменено на "Mirasol Estate", что соответствует названию канала "@MirasolEstate". Единый бренд создает целостное впечатление о сервисе и повышает уровень доверия пользователей.

### Инфраструктура проекта

1. **Основной хостинг (Vercel)**
   - Production: dualal.vercel.app
   - Preview environments для feature-веток
   - Автоматический деплой
   - Управление переменными окружения

2. **Тестовое окружение**
   - Тестовый бот в Telegram
   - Изолированная среда для разработки
   - Тестирование новых функций

3. **Telegram компоненты**
   - Основной бот: @MirasolEstate
   - Канал: @MirasolEstate
   - Тестовый бот: @mirasol_test_bot

### Стратегия "Бот-основа, Канал-инфоресурс"

После анализа текущего подхода к взаимодействию было принято решение о уточнении ролей бота и канала для более эффективного взаимодействия с пользователями:

1. **Telegram бот (основной интерфейс)**:
   - Полноценная персонализированная навигация по всем разделам
   - Полный функционал для взаимодействия с пользователями (аналог сайта)
   - Детальная информация о объектах недвижимости
   - Многоязычное меню и персональный контекст для каждого пользователя
   - Настройки, FAQ, контактная информация, поиск объектов
   - Основной инструмент взаимодействия с клиентами

2. **Telegram канал (информационный ресурс)**:
   - Публикация новостей и обновлений о рынке недвижимости
   - Анонсы новых объектов в портфолио
   - Информационные и образовательные материалы о недвижимости в Испании
   - Специальные предложения и акции
   - Приветственное сообщение с кнопками перехода к боту

### Технологическое взаимодействие бота и канала:
- Из канала в бот: приветственное сообщение и кнопки в постах
- Из бота в канал: раздел "Новости" с возможностью подписки на канал

### Функциональность бота
1. **Основной интерфейс**
   - Мультиязычное приветствие и навигация
   - Персонализированное главное меню
   - Информация о преимуществах объектов
   - Процесс покупки и особенности Торревьехи

2. **Каталог объектов**
   - Список доступных объектов
   - Фильтрация по параметрам
   - Детальная информация и галерея
   - Поиск по характеристикам

3. **Административная панель**
   - Управление контентом
   - Статистика и аналитика
   - Система уведомлений
   - Переключение окружений

4. **Технические требования**
   - Безопасность и права доступа
   - Производительность и оптимизация
   - Масштабируемость системы
   - Интеграция с базой данных

### Технологические преимущества нового подхода:
- Четкое разделение ролей и ответственности каждого компонента
- Упрощение разработки и поддержки компонентов
- Более интуитивный пользовательский опыт
- Фокусировка на ключевых функциях каждого компонента
- Возможность более эффективно развивать каждый компонент

## Система разработки и тестирования

### Управление переменными окружения

#### Структура .env файлов:
1. **Production (Vercel main)**
   - Боевые ключи и токены
   - Продакшн URLs и endpoints
   - Основные настройки бота

2. **Preview Environments (Vercel feature branches)**
   - Тестовые ключи и токены
   - Preview URLs и endpoints
   - Тестовые настройки бота

3. **Локальная разработка**
   - `.env.example` в репозитории (шаблон)
   - `.env` локально (в .gitignore)
   - Тестовые ключи разработчика

#### Процесс управления переменными:
1. Новая feature-ветка:
   - Создается новый Preview Environment в Vercel
   - Копируются переменные из main
   - Обновляются значения для тестирования

2. Локальная разработка:
   - Разработчик копирует `.env.example` в `.env`
   - Заполняет локальные значения
   - НЕ коммитит `.env` в репозиторий

3. Деплой в production:
   - Проверка всех переменных в main
   - Обновление значений если требуется
   - Подтверждение работоспособности

### Структура сред разработки и тестирования

Для обеспечения стабильной работы сервиса при одновременной разработке новой функциональности внедряется система разделения сред:

1. **Стабильная (продакшн) версия бота**:
   - Используется рядовыми пользователями
   - Содержит только проверенную функциональность
   - Изменения вносятся только после тщательного тестирования

2. **Тестовая (девелопмент) версия**:
   - Доступна только разработчикам и тестировщикам
   - Используется для разработки и проверки новой функциональности
   - Может содержать экспериментальные функции и интерфейсы

### Техническая реализация:
- Единый бот с системой переключения режимов для администраторов
- Обычные пользователи всегда получают стабильную версию
- Администраторы могут переключаться между режимами для тестирования
- Система публикации изменений из тестовой среды в стабильную

### Процесс внедрения изменений:
1. Разработка новой функциональности в тестовой среде
2. Всестороннее тестирование функционала в тестовой среде
3. Проверка на соответствие требованиям бизнеса
4. Публикация изменений в стабильной версии
5. Мониторинг работы функциональности в продакшн-среде

## Административный интерфейс (с уточнениями)

### Структура административной панели

Для эффективного управления всей системой разрабатывается административный интерфейс с следующими ключевыми разделами:

1. **Управление контентом**:
   - Добавление/редактирование/удаление объектов недвижимости
   - Управление изображениями объектов
   - Обновление информационных разделов (FAQ, описания, контакты)
   - Мультиязычное редактирование (поддержка всех используемых языков)

2. **Статистика и аналитика**:
   - Количество пользователей и активных сессий бота
   - Популярные запросы и разделы
   - Конверсия по запросам и просмотрам
   - Отчеты по временным периодам (день/неделя/месяц)

3. **Управление публикациями в канале**:
   - Создание и редактирование публикаций в канале
   - Планирование отложенных публикаций
   - Шаблоны для различных типов публикаций
   - Статистика по публикациям в канале

4. **Управление уведомлениями**:
   - Настройка автоматических уведомлений
   - Создание рассылок пользователям через бота
   - Шаблоны сообщений и уведомлений
   - Планирование отложенных рассылок

5. **Управление системой**:
   - Переключение между тестовым и стабильным режимами
   - Публикация обновлений функциональности
   - Мониторинг ошибок и системных событий
   - Резервное копирование и восстановление данных

### Безопасность административного интерфейса:
- Строгая аутентификация администраторов по Telegram ID
- Возможность дополнительной защиты паролем для критичных операций
- Разграничение прав доступа для разных типов администраторов
- Полное логирование всех административных действий

### Техническая реализация:
- Доступ по специальной команде (`/admin`) с проверкой ID пользователя
- Многоуровневое меню для навигации по административным функциям
- Изолированное хранение административных данных
- Журналирование всех административных действий