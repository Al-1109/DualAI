# Контекст проекта DualAI

## История и эволюция проекта
- Изначально проект был размещен на VPS (Windows Server)
- Был создан Telegram канал и бот mirasol_estate_bot для работы с недвижимостью
- Позже создан тестовый бот mirasol_test для разработки и миграции на Vercel
- В процессе миграция с VPS на Vercel для облегчения управления и масштабирования

## Архитектура и структура
- Telegram-бот с двухрежимным AI (административный и клиентский режимы)
- Многоязычная поддержка (en, es, de, fr, ru)
- Интеграция с OpenAI API (планируется)
- База данных SQLite для хранения объектов недвижимости (планируется)
- Планируется интеграция с Telegram Mini Apps для улучшения пользовательского опыта
- Деплой:
  - VPS с Windows Server для основного бота
  - Vercel для тестового бота и разработки (в процессе настройки)

## Репозиторий
- **Основные ветки:**
  - main - основная ветка, содержит первоначальную логику и структуру мультиязычных страниц
  - master - устаревшая основная ветка
  - feature/stable-base - попытка создать стабильную версию с деплоем на Vercel (неудачная)
  - feat/vercel-deployment-fix - попытка исправления для деплоя на Vercel (неудачная)
- **Локальные ветки:**
  - working_welcome - текущая рабочая ветка с улучшениями приветственного сообщения

## Текущее состояние
- Завершено 75% фазы 1 (Базовая инфраструктура)
- Реализован базовый Telegram-бот с системой маршрутизации и многоязычной поддержкой
- Активно разрабатывается механизм отправки и обновления сообщений в канале
- Все попытки деплоя на Vercel пока неудачные
- Не реализованы:
  - Интеграция с OpenAI API (файл openai_connector.py пустой)
  - Система управления базой данных (файл database.py пустой)
  - Административный функционал (handlers/admin.py в разработке)

## Текущие задачи и проблемы
- Настройка endpoint'ов и webhook'ов для Vercel
- Проблемы с деплоем на Vercel (все текущие попытки неудачные)
- Реализация интеграции с OpenAI API для обработки естественного языка
- Разработка схемы базы данных SQLite для хранения объектов недвижимости
- Разработка базовых административных функций
- Разработка системы управления объектами недвижимости

## Telegram-ресурсы
- Основной канал:
  - Название: New Age Realty
  - Username/ссылка: @New_Age_Realty
  - Описание: "Revolutionizing Real Estate in the World with Cutting-Edge Technology. Discover exclusive property listings, smart insights, and seamless transactions — your future home is just a click away!"
  - Подписчики: 2
  - Администраторы: 2
- Основной бот: @newage_realty_bot (используется на VPS)
- Тестовый бот: mirasol_test (используется для Vercel)

## Доступы и API
- **Telegram API**:
  - Основной бот (mirasol_estate_bot): настроен, токен в .env (переменная TELEGRAM_BOT_TOKEN)
  - Тестовый бот (mirasol_test): настроен, токен в .env (переменная TEST_TELEGRAM_BOT_TOKEN)
  - Доступ к каналу @MirasolEstate: настроен через переменную CHANNEL_ID в .env
  - Административный доступ: ID администратора в .env (переменная ADMIN_ID)

- **OpenAI API**:
  - Доступ через переменную OPENAI_API_KEY в .env
  - Планируется использование моделей GPT-3.5 или GPT-4
  - Файл openai_connector.py пока пуст и требует реализации
  - Статус: Настроен, но интеграция не завершена

- **Vercel**:
  - Проект настроен, информация в директории .vercel/
  - Webhook Secret в .env (переменная TEST_WEBHOOK_SECRET)
  - Среда: preview (переменная VERCEL_ENV)

## Инструкции по настройке среды разработки
1. Клонировать репозиторий
2. Создать виртуальное окружение Python: `python -m venv venv`
3. Активировать окружение:
   - Windows: `venv\Scripts\activate`
   - Unix/MacOS: `source venv/bin/activate`
4. Установить зависимости: `pip install -r requirements.txt`
5. Создать файл .env с необходимыми переменными окружения
6. Запустить бота: `python bot.py`

## Процесс обновления документации
- Файлы PROJECT_CONTEXT.md, DUALAI_DEVELOPMENT.md и PROJECT_STATUS.md должны обновляться при любых значимых изменениях в проекте
- Обновления должны отражать текущее состояние проекта, планы и проблемы
- При обновлении ветки main, документация должна быть актуализирована в первую очередь

## Полезные внешние ресурсы
- [Документация python-telegram-bot](https://docs.python-telegram-bot.org/)
- [Документация OpenAI API](https://platform.openai.com/docs/api-reference)
- [Документация Vercel](https://vercel.com/docs)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [Telegram Mini Apps](https://core.telegram.org/bots/webapps)

## Ключевые документы
- **DUALAI_DEVELOPMENT.md** - содержит полное описание архитектуры проекта, планируемые функции, технические требования и детали реализации. **Обязательно прочитать для понимания общей архитектуры.**
- **PROJECT_STATUS.md** - содержит актуальную информацию о текущем состоянии проекта, прогрессе разработки и ближайших планах. **Обязательно прочитать для понимания текущего статуса.**

## Ключевые файлы кода
- bot.py - основной файл бота
- utils.py - утилиты для работы с сообщениями
- handlers/client.py - обработчики клиентского режима
- handlers/admin.py - обработчики административного режима (в разработке)
- database.py - управление базой данных (в разработке)
- openai_connector.py - интеграция с OpenAI API (в разработке)
- .env - ключи и токены для API

## Ближайшие планы
- Завершение фазы 1 (Базовая инфраструктура)
- Переход к фазе 2 (Ядро системы) с фокусом на разработку механизма переключения между режимами
- Тестирование базовой функциональности с реальными пользователями

## Примечание по контексту
Этот файл контекста, а также DUALAI_DEVELOPMENT.md и PROJECT_STATUS.md должны регулярно обновляться, чтобы отражать актуальное состояние проекта. При начале работы с проектом следует в первую очередь ознакомиться с этими тремя документами.

## Инструкции для ИИ-ассистентов
При работе с проектом DualAI, следует:
1. В начале сеанса прочитать PROJECT_CONTEXT.md, DUALAI_DEVELOPMENT.md и PROJECT_STATUS.md
2. Учитывать текущее состояние проекта и нерешенные проблемы
3. Предлагать решения, соответствующие архитектуре проекта
4. Обращать особое внимание на проблемы с деплоем на Vercel
5. При необходимости обновлять документацию для отражения новых решений и идей 

## Инструкции для выполнения деплоя на Vercel
1. Выполнить деплой на Vercel:
   ```
   vercel --prod
   ```

2. Настроить webhook в Telegram:
   ```
   python set_webhook.py --url https://[ваш-проект].vercel.app/webhook
   ```

3. Проверить работу webhook:
   - Отправить сообщение боту
   - Проверить логи на Vercel 