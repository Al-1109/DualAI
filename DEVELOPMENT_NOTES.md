# Заметки по разработке DualAI

## Настройка окружения разработки

1. Установить Python 3.13.2
2. Создать виртуальное окружение: `python -m venv venv`
3. Активировать виртуальное окружение:
   - Windows: `venv\Scripts\activate`
   - Linux/Mac: `source venv/bin/activate`
4. Установить зависимости: `pip install -r requirements.txt`
5. Создать файл `.env` с необходимыми переменными окружения (см. пример в `.env.example`)

## Известные проблемы и их решения

### Проблема с обновлением приветственного сообщения

**Симптомы:** При перезапуске бота не происходит корректная очистка канала и обновление приветственного сообщения, особенно если пользователь находился в другом разделе меню.

**Решение:**

1. Добавить файл `data/channel_messages.json` в `.gitignore`:
   ```
   # Файлы с состоянием сообщений канала
   data/channel_messages.json
   ```

2. Выполнить команду для игнорирования изменений в уже отслеживаемом файле:
   ```bash
   git update-index --assume-unchanged data/channel_messages.json
   ```

3. **Важно:** Состояние Git и наличие незакоммиченных изменений в файле channel_messages.json влияет на работу функции очистки канала. Рекомендуется держать этот файл в состоянии с незакоммиченными изменениями.

### Проблема с циклическими зависимостями

**Симптомы:** Ошибки импорта из-за циклических зависимостей между модулями (например, между `bot.py` и `handlers/client.py`).

**Решение:**
- Импортировать модули внутри функций, где они используются, а не на верхнем уровне файла
- Использовать инъекцию зависимостей через параметры функций
- Перенести общие функции в отдельный модуль, который не зависит от других модулей проекта

## Советы по работе с проектом

1. При добавлении нового функционала начинайте с создания отдельной ветки: `git checkout -b feature/название_функции`

2. Используйте согласованный формат коммитов:
   - `[feat]: добавлена новая функция`
   - `[fix]: исправлена ошибка`
   - `[docs]: обновлена документация`
   - `[refactor]: рефакторинг кода без изменения функциональности`

3. Всегда тестируйте изменения перед созданием pull request или слиянием с основной веткой

4. При изменении структуры базы данных обновляйте соответствующую документацию